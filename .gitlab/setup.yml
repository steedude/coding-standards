variables:
  NODE_VERSION: '20'
  PNPM_VERSION: '9'
  CACHE_KEY: '${CI_RUNNER_TAGS}-${CI_COMMIT_REF_SLUG}-${CI_PROJECT_NAME}-${CI_COMMIT_SHA}'

cache:
  key: ${CACHE_KEY}
  paths:
    - .pnpm-store
    - node_modules/

setup:
  stage: setup
  image: node:${NODE_VERSION}-alpine
  script:
    - apk add --no-cache bash curl
    - curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm@${PNPM_VERSION}
    - mkdir -p .pnpm-store
    - pnpm config set store-dir .pnpm-store

install:
  stage: install dependencies
  image: node:${NODE_VERSION}-alpine
  cache:
    paths:
      - .pnpm-store
      - node_modules/
  script:
    - pnpm install
  only:
    - branches
